<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta name="description" content="Al Marya Rostery Business Management Portal - Secure coffee business administration">
    <meta name="keywords" content="coffee, business, admin, management, qahwat, emirates">
    <meta name="author" content="Al Marya Rostery">
    <meta name="robots" content="noindex, nofollow">
    <title>Al Marya Rostery - Business Portal</title>
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    
    <!-- Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <!-- Google Identity Services script -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <!-- Main Styles -->
    <link rel="stylesheet" href="admin.css">
</head>
<body class="login-mode">
    <!-- Login Container -->
    <div id="loginContainer" class="login-container">
        <div class="container">
            <div class="logo">‚òï</div>
            <h1>Al Marya Rostery</h1>
            <p class="subtitle">Business Management Portal</p>
            
            <div class="login-form">
                <form id="adminLoginForm">
                    <div class="form-group">
                        <label for="loginUsername">Username</label>
                        <input type="text" id="loginUsername" name="username" class="form-control" required>
                        <div id="username-error" class="alert alert-error" style="display: none;"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" name="password" class="form-control" required>
                        <div id="password-error" class="alert alert-error" style="display: none;"></div>
                    </div>
                    
                    <button type="submit" id="loginBtn" class="portal-btn">
                        Login to Admin Panel
                    </button>
                    
                    <div id="loginLoading" class="login-loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Logging in...</p>
                    </div>
                    
                    <div id="loginError" class="alert alert-error" style="display: none;">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span id="loginErrorMessage">Invalid username or password</span>
                    </div>
                    
                    <div id="loginSuccess" class="alert alert-success" style="display: none;">
                        <i class="fas fa-check-circle"></i>
                        Login successful! Redirecting...
                    </div>
                    
                    <div class="forgot-password">
                        <a href="#" id="forgot-password-link">Forgot Password?</a>
                    </div>
                </form>
            </div>
            
            <!-- Development-only credentials display -->
            <div class="login-info" id="devCredentials" style="display:none;">
                <strong>‚ö†Ô∏è Development Mode:</strong><br>
                Username: admin<br>
                Password: almarya2024<br>
                <small style="color: #ff6b6b;">This is only visible in development</small>
            </div>
        </div>
    </div>

    <!-- Admin Layout -->
    <div id="adminLayout" class="admin-layout">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1>‚òï Al Marya</h1>
                <p>Business Portal</p>
            </div>
            <nav class="sidebar-menu">
                <button class="menu-item active" onclick="showSection('dashboard')">
                    <i class="fas fa-chart-line"></i> Dashboard
                </button>
                <button class="menu-item" onclick="showSection('products')">
                    <i class="fas fa-coffee"></i> Products
                </button>
                <button class="menu-item" onclick="showSection('categories')">
                    <i class="fas fa-tags"></i> Categories
                </button>
                <button class="menu-item" onclick="showSection('orders')">
                    <i class="fas fa-shopping-cart"></i> Orders
                </button>
                <button class="menu-item" onclick="showSection('users')">
                    <i class="fas fa-users"></i> Users
                </button>
                <button class="menu-item" onclick="showSection('sliders')">
                    <i class="fas fa-images"></i> Hero Banners
                </button>
                <button class="menu-item" onclick="showSection('firebase')">
                    <i class="fas fa-sync"></i> Firebase Management
                </button>
                <button class="menu-item" onclick="showSection('analytics')">
                    <i class="fas fa-chart-pie"></i> Analytics
                </button>
                <button class="menu-item" onclick="showSection('reports')">
                    <i class="fas fa-file-alt"></i> Reports
                </button>
                <button class="menu-item" onclick="showSection('settings')">
                    <i class="fas fa-cog"></i> Settings
                </button>
                <button class="menu-item" onclick="logout()" style="margin-top: 2rem; background: rgba(255,255,255,0.1);">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Section -->
            <section id="dashboard" class="content-section active">
                <div class="content-header">
                    <h2><i class="fas fa-chart-line"></i> Dashboard</h2>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="refreshDashboard()">
                            <i class="fas fa-refresh"></i> Refresh
                        </button>
                    </div>
                </div>
                
                <div id="dashboardStats">
                    <!-- Stats will be loaded here -->
                </div>
                
                <div class="section-card">
                    <div class="section-header">
                        <h3>Revenue Trend</h3>
                    </div>
                    <div class="section-content">
                        <div class="chart-container">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="section-card">
                    <div class="section-header">
                        <h3>Recent Orders</h3>
                    </div>
                    <div class="section-content">
                        <div id="recentOrdersTable">
                            <!-- Recent orders will be loaded here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Products Section -->
            <section id="products" class="content-section">
                <div class="content-header">
                    <h2><i class="fas fa-coffee"></i> Products Management</h2>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="showAddProductModal()">
                            <i class="fas fa-plus"></i> Add Product
                        </button>
                    </div>
                </div>
                
                <div class="section-card">
                    <div class="section-content">
                        <div id="productsTable">
                            <!-- Products table will be loaded here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Categories Section -->
            <section id="categories" class="content-section">
                <div class="content-header">
                    <h2><i class="fas fa-tags"></i> Categories Management</h2>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="showAddCategoryModal()">
                            <i class="fas fa-plus"></i> Add Category
                        </button>
                    </div>
                </div>
                
                <div class="section-card">
                    <div class="section-content">
                        <div id="categoriesTable">
                            <!-- Categories table will be loaded here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Orders Section -->
            <section id="orders" class="content-section">
                <div class="content-header">
                    <h2><i class="fas fa-shopping-cart"></i> Orders Management</h2>
                    <div class="header-actions">
                        <select id="orderStatusFilter" class="form-control" onchange="loadOrders()">
                            <option value="">All Orders</option>
                            <option value="pending">Pending</option>
                            <option value="confirmed">Confirmed</option>
                            <option value="preparing">Preparing</option>
                            <option value="ready">Ready</option>
                            <option value="delivered">Delivered</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">‚è≥</div>
                        <div class="stat-info">
                            <h3 id="pendingOrders">0</h3>
                            <p>Pending Orders</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üë®‚Äçüç≥</div>
                        <div class="stat-info">
                            <h3 id="preparingOrders">0</h3>
                            <p>Preparing</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-info">
                            <h3 id="completedOrders">0</h3>
                            <p>Completed</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-info">
                            <h3 id="todayRevenue">AED 0</h3>
                            <p>Today's Revenue</p>
                        </div>
                    </div>
                </div>
                
                <div class="section-card">
                    <div class="section-content">
                        <div id="ordersTable">
                            <!-- Orders table will be loaded here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Users Section -->
            <section id="users" class="content-section">
                <div class="content-header">
                    <h2><i class="fas fa-users"></i> Users Management</h2>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="showAddUserModal()">
                            <i class="fas fa-plus"></i> Add User
                        </button>
                    </div>
                </div>
                
                <div class="section-card">
                    <div class="section-content">
                        <div id="usersTable">
                            <!-- Users table will be loaded here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Firebase Management Section -->
            <section id="firebase" class="content-section">
                <div class="content-header">
                    <h2><i class="fas fa-sync"></i> Firebase Management</h2>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="refreshFirebaseStatus()">
                            <i class="fas fa-refresh"></i> Refresh Status
                        </button>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üî•</div>
                        <div class="stat-info">
                            <h3 id="firebaseUserCount">0</h3>
                            <p>Firebase Users</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üíæ</div>
                        <div class="stat-info">
                            <h3 id="localUserCount">0</h3>
                            <p>Local Users</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-info">
                            <h3 id="syncSuccessCount">0</h3>
                            <p>Successful Syncs</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è∞</div>
                        <div class="stat-info">
                            <h3 id="lastSyncTime">Never</h3>
                            <p>Last Sync</p>
                        </div>
                    </div>
                </div>

                <div class="section-card">
                    <div class="section-header">
                        <h3>Auto Sync Control</h3>
                    </div>
                    <div class="section-content">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Status</label>
                                <span id="autoSyncStatus" class="sync-status-badge inactive">
                                    <i class="fas fa-circle"></i> Inactive
                                </span>
                            </div>
                            <div class="form-group">
                                <label for="syncInterval">Interval (seconds)</label>
                                <input type="number" id="syncInterval" min="30" max="3600" value="60" class="form-control">
                            </div>
                        </div>
                        <div class="btn-group">
                            <button id="startSyncBtn" class="btn btn-success" onclick="startAutoSync()">
                                <i class="fas fa-play"></i> Start Auto Sync
                            </button>
                            <button id="stopSyncBtn" class="btn btn-danger" onclick="stopAutoSync()" disabled>
                                <i class="fas fa-stop"></i> Stop Auto Sync
                            </button>
                            <button id="manualSyncBtn" class="btn btn-primary" onclick="performManualSync()">
                                <i class="fas fa-sync"></i> Manual Sync
                            </button>
                        </div>
                    </div>
                </div>

                <div class="section-card">
                    <div class="section-header">
                        <h3>Sync Logs</h3>
                        <button class="btn btn-sm btn-secondary" onclick="clearSyncLogs()">
                            <i class="fas fa-trash"></i> Clear Logs
                        </button>
                    </div>
                    <div class="section-content">
                        <div id="syncLogs" class="sync-logs">
                            <!-- Sync logs will be displayed here -->
                        </div>
                    </div>
                </div>

                <div class="section-card">
                    <div class="section-header">
                        <h3>Firebase Users</h3>
                    </div>
                    <div class="section-content">
                        <div id="firebaseUsersTable">
                            <!-- Firebase users table will be loaded here -->
                        </div>
                    </div>
                </div>

                <div class="section-card">
                    <div class="section-header">
                        <h3>Local Users</h3>
                    </div>
                    <div class="section-content">
                        <div id="localUsersTable">
                            <!-- Local users table will be loaded here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Other Sections (Analytics, Reports, Settings, Sliders) -->
            <section id="analytics" class="content-section">
                <div class="content-header">
                    <h2><i class="fas fa-chart-pie"></i> Analytics</h2>
                </div>
                <div class="section-card">
                    <div class="section-content">
                        <p>Analytics features coming soon...</p>
                    </div>
                </div>
            </section>

            <section id="reports" class="content-section">
                <div class="content-header">
                    <h2><i class="fas fa-file-alt"></i> Reports</h2>
                </div>
                <div class="section-card">
                    <div class="section-content">
                        <p>Reports features coming soon...</p>
                    </div>
                </div>
            </section>

            <section id="settings" class="content-section">
                <div class="content-header">
                    <h2><i class="fas fa-cog"></i> Settings</h2>
                </div>
                <div class="section-card">
                    <div class="section-content">
                        <p>Settings features coming soon...</p>
                    </div>
                </div>
            </section>

            <section id="sliders" class="content-section">
                <div class="content-header">
                    <h2><i class="fas fa-images"></i> Hero Banners</h2>
                </div>
                <div class="section-card">
                    <div class="section-content">
                        <div id="slidersTable">
                            <!-- Sliders table will be loaded here -->
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Global Loading Overlay -->
    <div id="globalLoading" class="global-loading">
        <div style="text-align: center;">
            <div class="spinner"></div>
            <div id="loadingText">Loading...</div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" style="position: fixed; top: 20px; right: 20px; z-index: 10001;"></div>

    <!-- JavaScript Files -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/products.js"></script>
    <script src="js/orders.js"></script>
    <script src="js/users.js"></script>
    <script src="js/categories.js"></script>
    <script src="js/firebase.js"></script>
    
    <!-- Show dev credentials only in development -->
    <script>
        // Only show admin credentials in development environment
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            const devCredentials = document.getElementById('devCredentials');
            if (devCredentials) {
                devCredentials.style.display = 'block';
            }
        }
    </script>
</body>
</html>
